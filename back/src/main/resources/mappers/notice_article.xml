<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.PathPartner.notice_article.repository.notice_articleDao">

    <resultMap type="notice_articleDto" id="notice_articleResultMap">
        <result column="noticearticle_id" property="noticearticle_id"/>
        <result column="title" property="title"/>
        <result column="content" property="content"/>
        <result column="creation_date" property="creation_date"/>
        <result column="uuid" property="uuid"/>
    </resultMap>

    <sql id="search">
        <if test="word != null and word != ''">
            <if test="key == 'notice_article_title'">
                and notice_article_title like concat('%', #{word}, '%')
            </if>
            <if test="key != 'notice_article_title'">
                and ${key} = #{word}
            </if>
        </if>
    </sql>

    <select id="getnotice_articleList" parameterType="map" resultMap="notice_articleResultMap">
        select noticearticle_id, title, content, creation_date, uuid
        from notice_article
        <include refid="search"></include>
        order by notice_article_no desc
        limit #{start}, #{listsize}
    </select>

    <select id="getnotice_article" parameterType="int" resultMap="notice_articleResultMap">
        select noticearticle_id, title, content, creation_date, uuid
        from notice_article
        where notice_article_no = #{noticeArticleNo}
    </select>

    <insert id="createnotice_article" parameterType="notice_articleDto">
        insert into notice_article (noticearticle_id,title, content, creation_date, uuid)
        values (UUID(),#{title}, #{content}, now(), #{uuid})
        <selectKey resultType="int" keyProperty="noticeArticleNo" order="AFTER">
            select last_insert_id()
        </selectKey>
    </insert>

    <update id="editnotice_article" parameterType="notice_articleDto">
        update notice_article
        <set>
            title = #{title},
            content = #{content}
        </set>
        where noticearticle_id = #{noticearticle_id}
    </update>

    <delete id="deletenotice_article" parameterType="int">
        delete from notice_article
        where noticearticle_id = #{noticearticle_id}
    </delete>

</mapper>